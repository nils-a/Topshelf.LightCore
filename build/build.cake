#tool nuget:?package=NUnit.ConsoleRunner&version=3.4.0
//////////////////////////////////////////////////////////////////////
// ARGUMENTS
//////////////////////////////////////////////////////////////////////

var target = Argument("target", "Default");
var configuration = Argument("configuration", "Release");

//////////////////////////////////////////////////////////////////////
// PREPARATION
//////////////////////////////////////////////////////////////////////

// Define directories.
var rootDir = Directory("..");
var srcDir = rootDir + Directory("src");
var binDir = rootDir + Directory("bin");
var distDir = rootDir + Directory("dist");

//////////////////////////////////////////////////////////////////////
// TASKS
//////////////////////////////////////////////////////////////////////

Task("Clean")
    .Does(() =>
{
    CleanDirectory(binDir);
    CleanDirectory(distDir);
});


Task("Build")
    .IsDependentOn("Clean")
    .Does(() =>
{
    foreach(var f in new[] {
        srcDir + File("Topshelf.LightCore/Topshelf.LightCore.sln")
    }) {
        //NuGetRestore(f);
        MSBuild(f, settings => {
            settings.SetConfiguration(configuration);
            settings.Restore = true;
        });
    }
});

Task("Dist")
    .IsDependentOn("Build")
    .Does(() => 
{
    var files = GetFiles(binDir.ToString() + "/**/*.nupkg");
    CopyFiles(files, distDir);
});


//////////////////////////////////////////////////////////////////////
// TASK TARGETS
//////////////////////////////////////////////////////////////////////

Task("Default")
    .IsDependentOn("Dist");

//////////////////////////////////////////////////////////////////////
// EXECUTION
//////////////////////////////////////////////////////////////////////

RunTarget(target);